<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>비교 분석</title>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#fff; }
  .wrap { max-width:1200px; margin:40px auto; padding:0 16px; }
  h2 { margin:0 0 12px; }

  .block { border:1px solid #eee; border-radius:12px; padding:12px; margin-bottom:16px; }
  .title { font-size:14px; margin:4px 6px 8px; }
  .chart { height:420px; }

  .btn{
    border:1px solid #ddd; background:#fff; padding:8px 10px; border-radius:10px;
    cursor:pointer; font-size:13px;
  }
  .btn.active{ border-color:#1f77b4; color:#fff; background:#1f77b4; font-weight:600; }
</style>
</head>
<body data-page="compare">
<div class="wrap">
  <h2>비교 분석</h2>

  <div class="block" style="display:flex; gap:8px; align-items:center;">
    <div class="title" style="margin:0;">기간</div>
    <button class="btn" data-range="ALL">전체</button>
    <button class="btn" data-range="2024">2024</button>
    <button class="btn" data-range="2025">2025</button>
    <div id="rangeNote" style="margin-left:auto; font-size:12px; color:#666;"></div>
  </div>

  <div class="block">
    <div class="title">생산문서수 평균</div>
    <div id="c1" class="chart"></div>
  </div>

  <div class="block">
    <div class="title">결재시간 평균</div>
    <div id="c2" class="chart"></div>
  </div>

  <div class="block">
    <div class="title">문서공개율 평균</div>
    <div id="c3" class="chart"></div>
  </div>
</div>

<script>
const DATASETS = {"meta": {"columns": {"PROD_COL": null, "TIME_COL": "결재시간_영업일", "RATE_COL": null, "DISCLOSE_COL": "공개여부", "YEAR_COL": "연도"}}, "ALL": {"PROD": [{"국": "동주민센터", "생산문서수_평균": 188288.0, "결재시간_평균": 0.25178450033990485, "문서공개율_평균": 0.37280124065261727, "표본수": 188288}, {"국": "주민생활국", "생산문서수_평균": 124790.0, "결재시간_평균": 0.41515345780911933, "문서공개율_평균": 0.11350268450997676, "표본수": 124790}, {"국": "안전건설국", "생산문서수_평균": 115625.0, "결재시간_평균": 0.32742054054054054, "문서공개율_평균": 0.11351351351351352, "표본수": 115625}, {"국": "공간혁신국", "생산문서수_평균": 113356.0, "결재시간_평균": 0.3122022654292671, "문서공개율_평균": 0.2032887540139031, "표본수": 113356}, {"국": "보건소", "생산문서수_평균": 100410.0, "결재시간_평균": 0.26248381635295287, "문서공개율_평균": 0.1224081266806095, "표본수": 100410}, {"국": "도시관리국", "생산문서수_평균": 99552.0, "결재시간_평균": 0.1685752169720347, "문서공개율_평균": 0.06110374477659916, "표본수": 99552}, {"국": "문화행정국", "생산문서수_평균": 98897.0, "결재시간_평균": 0.2966116262373985, "문서공개율_평균": 0.24703479377534202, "표본수": 98897}, {"국": "기획재정국", "생산문서수_평균": 78241.0, "결재시간_평균": 0.23754808859804963, "문서공개율_평균": 0.09992203576130163, "표본수": 78241}, {"국": "밝은미래국", "생산문서수_평균": 72664.0, "결재시간_평균": 0.31253440493229107, "문서공개율_평균": 0.1745568644720907, "표본수": 72664}, {"국": "직속기관", "생산문서수_평균": 16326.0, "결재시간_평균": 0.2318387847605047, "문서공개율_평균": 0.270243782922945, "표본수": 16326}], "TIME": [{"국": "주민생활국", "생산문서수_평균": 124790.0, "결재시간_평균": 0.41515345780911933, "문서공개율_평균": 0.11350268450997676, "표본수": 124790}, {"국": "안전건설국", "생산문서수_평균": 115625.0, "결재시간_평균": 0.32742054054054054, "문서공개율_평균": 0.11351351351351352, "표본수": 115625}, {"국": "밝은미래국", "생산문서수_평균": 72664.0, "결재시간_평균": 0.31253440493229107, "문서공개율_평균": 0.1745568644720907, "표본수": 72664}, {"국": "공간혁신국", "생산문서수_평균": 113356.0, "결재시간_평균": 0.3122022654292671, "문서공개율_평균": 0.2032887540139031, "표본수": 113356}, {"국": "문화행정국", "생산문서수_평균": 98897.0, "결재시간_평균": 0.2966116262373985, "문서공개율_평균": 0.24703479377534202, "표본수": 98897}, {"국": "보건소", "생산문서수_평균": 100410.0, "결재시간_평균": 0.26248381635295287, "문서공개율_평균": 0.1224081266806095, "표본수": 100410}, {"국": "동주민센터", "생산문서수_평균": 188288.0, "결재시간_평균": 0.25178450033990485, "문서공개율_평균": 0.37280124065261727, "표본수": 188288}, {"국": "기획재정국", "생산문서수_평균": 78241.0, "결재시간_평균": 0.23754808859804963, "문서공개율_평균": 0.09992203576130163, "표본수": 78241}, {"국": "직속기관", "생산문서수_평균": 16326.0, "결재시간_평균": 0.2318387847605047, "문서공개율_평균": 0.270243782922945, "표본수": 16326}, {"국": "도시관리국", "생산문서수_평균": 99552.0, "결재시간_평균": 0.1685752169720347, "문서공개율_평균": 0.06110374477659916, "표본수": 99552}], "OPEN": [{"국": "동주민센터", "생산문서수_평균": 188288.0, "결재시간_평균": 0.25178450033990485, "문서공개율_평균": 0.37280124065261727, "표본수": 188288}, {"국": "직속기관", "생산문서수_평균": 16326.0, "결재시간_평균": 0.2318387847605047, "문서공개율_평균": 0.270243782922945, "표본수": 16326}, {"국": "문화행정국", "생산문서수_평균": 98897.0, "결재시간_평균": 0.2966116262373985, "문서공개율_평균": 0.24703479377534202, "표본수": 98897}, {"국": "공간혁신국", "생산문서수_평균": 113356.0, "결재시간_평균": 0.3122022654292671, "문서공개율_평균": 0.2032887540139031, "표본수": 113356}, {"국": "밝은미래국", "생산문서수_평균": 72664.0, "결재시간_평균": 0.31253440493229107, "문서공개율_평균": 0.1745568644720907, "표본수": 72664}, {"국": "보건소", "생산문서수_평균": 100410.0, "결재시간_평균": 0.26248381635295287, "문서공개율_평균": 0.1224081266806095, "표본수": 100410}, {"국": "안전건설국", "생산문서수_평균": 115625.0, "결재시간_평균": 0.32742054054054054, "문서공개율_평균": 0.11351351351351352, "표본수": 115625}, {"국": "주민생활국", "생산문서수_평균": 124790.0, "결재시간_평균": 0.41515345780911933, "문서공개율_평균": 0.11350268450997676, "표본수": 124790}, {"국": "기획재정국", "생산문서수_평균": 78241.0, "결재시간_평균": 0.23754808859804963, "문서공개율_평균": 0.09992203576130163, "표본수": 78241}, {"국": "도시관리국", "생산문서수_평균": 99552.0, "결재시간_평균": 0.1685752169720347, "문서공개율_평균": 0.06110374477659916, "표본수": 99552}]}, "2024": {"PROD": [{"국": "동주민센터", "생산문서수_평균": 94740.0, "결재시간_평균": 0.23812539582013934, "문서공개율_평균": 0.3972028710154106, "표본수": 94740}, {"국": "주민생활국", "생산문서수_평균": 61411.0, "결재시간_평균": 0.4148930973278403, "문서공개율_평균": 0.12611747081141814, "표본수": 61411}, {"국": "공간혁신국", "생산문서수_평균": 57761.0, "결재시간_평균": 0.3023839614965115, "문서공개율_평균": 0.22309170547601323, "표본수": 57761}, {"국": "안전건설국", "생산문서수_평균": 57082.0, "결재시간_평균": 0.34660663606741177, "문서공개율_평균": 0.12828912792123612, "표본수": 57082}, {"국": "보건소", "생산문서수_평균": 50065.0, "결재시간_평균": 0.2734445221212424, "문서공개율_평균": 0.14513132927194647, "표본수": 50065}, {"국": "문화행정국", "생산문서수_평균": 47665.0, "결재시간_평균": 0.3237595720130074, "문서공개율_평균": 0.28419175495646704, "표본수": 47665}, {"국": "도시관리국", "생산문서수_평균": 46791.0, "결재시간_평균": 0.16221068154132204, "문서공개율_평균": 0.07206514073219208, "표본수": 46791}, {"국": "기획재정국", "생산문서수_평균": 39607.0, "결재시간_평균": 0.24632009493271392, "문서공개율_평균": 0.10841517913500139, "표본수": 39607}, {"국": "밝은미래국", "생산문서수_평균": 35028.0, "결재시간_평균": 0.3444672833162042, "문서공개율_평균": 0.20266643827794906, "표본수": 35028}, {"국": "직속기관", "생산문서수_평균": 8104.0, "결재시간_평균": 0.22729516288252716, "문서공개율_평균": 0.29195459032576504, "표본수": 8104}], "TIME": [{"국": "주민생활국", "생산문서수_평균": 61411.0, "결재시간_평균": 0.4148930973278403, "문서공개율_평균": 0.12611747081141814, "표본수": 61411}, {"국": "안전건설국", "생산문서수_평균": 57082.0, "결재시간_평균": 0.34660663606741177, "문서공개율_평균": 0.12828912792123612, "표본수": 57082}, {"국": "밝은미래국", "생산문서수_평균": 35028.0, "결재시간_평균": 0.3444672833162042, "문서공개율_평균": 0.20266643827794906, "표본수": 35028}, {"국": "문화행정국", "생산문서수_평균": 47665.0, "결재시간_평균": 0.3237595720130074, "문서공개율_평균": 0.28419175495646704, "표본수": 47665}, {"국": "공간혁신국", "생산문서수_평균": 57761.0, "결재시간_평균": 0.3023839614965115, "문서공개율_평균": 0.22309170547601323, "표본수": 57761}, {"국": "보건소", "생산문서수_평균": 50065.0, "결재시간_평균": 0.2734445221212424, "문서공개율_평균": 0.14513132927194647, "표본수": 50065}, {"국": "기획재정국", "생산문서수_평균": 39607.0, "결재시간_평균": 0.24632009493271392, "문서공개율_평균": 0.10841517913500139, "표본수": 39607}, {"국": "동주민센터", "생산문서수_평균": 94740.0, "결재시간_평균": 0.23812539582013934, "문서공개율_평균": 0.3972028710154106, "표본수": 94740}, {"국": "직속기관", "생산문서수_평균": 8104.0, "결재시간_평균": 0.22729516288252716, "문서공개율_평균": 0.29195459032576504, "표본수": 8104}, {"국": "도시관리국", "생산문서수_평균": 46791.0, "결재시간_평균": 0.16221068154132204, "문서공개율_평균": 0.07206514073219208, "표본수": 46791}], "OPEN": [{"국": "동주민센터", "생산문서수_평균": 94740.0, "결재시간_평균": 0.23812539582013934, "문서공개율_평균": 0.3972028710154106, "표본수": 94740}, {"국": "직속기관", "생산문서수_평균": 8104.0, "결재시간_평균": 0.22729516288252716, "문서공개율_평균": 0.29195459032576504, "표본수": 8104}, {"국": "문화행정국", "생산문서수_평균": 47665.0, "결재시간_평균": 0.3237595720130074, "문서공개율_평균": 0.28419175495646704, "표본수": 47665}, {"국": "공간혁신국", "생산문서수_평균": 57761.0, "결재시간_평균": 0.3023839614965115, "문서공개율_평균": 0.22309170547601323, "표본수": 57761}, {"국": "밝은미래국", "생산문서수_평균": 35028.0, "결재시간_평균": 0.3444672833162042, "문서공개율_평균": 0.20266643827794906, "표본수": 35028}, {"국": "보건소", "생산문서수_평균": 50065.0, "결재시간_평균": 0.2734445221212424, "문서공개율_평균": 0.14513132927194647, "표본수": 50065}, {"국": "안전건설국", "생산문서수_평균": 57082.0, "결재시간_평균": 0.34660663606741177, "문서공개율_평균": 0.12828912792123612, "표본수": 57082}, {"국": "주민생활국", "생산문서수_평균": 61411.0, "결재시간_평균": 0.4148930973278403, "문서공개율_평균": 0.12611747081141814, "표본수": 61411}, {"국": "기획재정국", "생산문서수_평균": 39607.0, "결재시간_평균": 0.24632009493271392, "문서공개율_평균": 0.10841517913500139, "표본수": 39607}, {"국": "도시관리국", "생산문서수_평균": 46791.0, "결재시간_평균": 0.16221068154132204, "문서공개율_평균": 0.07206514073219208, "표본수": 46791}]}, "2025": {"PROD": [{"국": "동주민센터", "생산문서수_평균": 93548.0, "결재시간_평균": 0.2656176508316586, "문서공개율_평균": 0.3480886817462693, "표본수": 93548}, {"국": "주민생활국", "생산문서수_평균": 63379.0, "결재시간_평균": 0.4154057337603938, "문서공개율_평균": 0.10127960365420723, "표본수": 63379}, {"국": "안전건설국", "생산문서수_평균": 58543.0, "결재시간_평균": 0.30871325350596995, "문서공개율_평균": 0.0991066395640811, "표본수": 58543}, {"국": "공간혁신국", "생산문서수_평균": 55595.0, "결재시간_평균": 0.3224030938033996, "문서공개율_평균": 0.18271427286626496, "표본수": 55595}, {"국": "도시관리국", "생산문서수_평균": 52761.0, "결재시간_평균": 0.17421959401830897, "문서공개율_평균": 0.05138265006349387, "표본수": 52761}, {"국": "문화행정국", "생산문서수_평균": 51232.0, "결재시간_평균": 0.2713538413491568, "문서공개율_평균": 0.21246486570893192, "표본수": 51232}, {"국": "보건소", "생산문서수_평균": 50345.0, "결재시간_평균": 0.25158406991756876, "문서공개율_평균": 0.09981130201608898, "표본수": 50345}, {"국": "기획재정국", "생산문서수_평균": 38634.0, "결재시간_평균": 0.22855515866853032, "문서공개율_평균": 0.09121499197597971, "표본수": 38634}, {"국": "밝은미래국", "생산문서수_평균": 37636.0, "결재시간_평균": 0.2828143267084706, "문서공개율_평균": 0.14839515357636307, "표본수": 37636}, {"국": "직속기관", "생산문서수_평균": 8222.0, "결재시간_평균": 0.23631719776210167, "문서공개율_평균": 0.24884456336657748, "표본수": 8222}], "TIME": [{"국": "주민생활국", "생산문서수_평균": 63379.0, "결재시간_평균": 0.4154057337603938, "문서공개율_평균": 0.10127960365420723, "표본수": 63379}, {"국": "공간혁신국", "생산문서수_평균": 55595.0, "결재시간_평균": 0.3224030938033996, "문서공개율_평균": 0.18271427286626496, "표본수": 55595}, {"국": "안전건설국", "생산문서수_평균": 58543.0, "결재시간_평균": 0.30871325350596995, "문서공개율_평균": 0.0991066395640811, "표본수": 58543}, {"국": "밝은미래국", "생산문서수_평균": 37636.0, "결재시간_평균": 0.2828143267084706, "문서공개율_평균": 0.14839515357636307, "표본수": 37636}, {"국": "문화행정국", "생산문서수_평균": 51232.0, "결재시간_평균": 0.2713538413491568, "문서공개율_평균": 0.21246486570893192, "표본수": 51232}, {"국": "동주민센터", "생산문서수_평균": 93548.0, "결재시간_평균": 0.2656176508316586, "문서공개율_평균": 0.3480886817462693, "표본수": 93548}, {"국": "보건소", "생산문서수_평균": 50345.0, "결재시간_평균": 0.25158406991756876, "문서공개율_평균": 0.09981130201608898, "표본수": 50345}, {"국": "직속기관", "생산문서수_평균": 8222.0, "결재시간_평균": 0.23631719776210167, "문서공개율_평균": 0.24884456336657748, "표본수": 8222}, {"국": "기획재정국", "생산문서수_평균": 38634.0, "결재시간_평균": 0.22855515866853032, "문서공개율_평균": 0.09121499197597971, "표본수": 38634}, {"국": "도시관리국", "생산문서수_평균": 52761.0, "결재시간_평균": 0.17421959401830897, "문서공개율_평균": 0.05138265006349387, "표본수": 52761}], "OPEN": [{"국": "동주민센터", "생산문서수_평균": 93548.0, "결재시간_평균": 0.2656176508316586, "문서공개율_평균": 0.3480886817462693, "표본수": 93548}, {"국": "직속기관", "생산문서수_평균": 8222.0, "결재시간_평균": 0.23631719776210167, "문서공개율_평균": 0.24884456336657748, "표본수": 8222}, {"국": "문화행정국", "생산문서수_평균": 51232.0, "결재시간_평균": 0.2713538413491568, "문서공개율_평균": 0.21246486570893192, "표본수": 51232}, {"국": "공간혁신국", "생산문서수_평균": 55595.0, "결재시간_평균": 0.3224030938033996, "문서공개율_평균": 0.18271427286626496, "표본수": 55595}, {"국": "밝은미래국", "생산문서수_평균": 37636.0, "결재시간_평균": 0.2828143267084706, "문서공개율_평균": 0.14839515357636307, "표본수": 37636}, {"국": "주민생활국", "생산문서수_평균": 63379.0, "결재시간_평균": 0.4154057337603938, "문서공개율_평균": 0.10127960365420723, "표본수": 63379}, {"국": "보건소", "생산문서수_평균": 50345.0, "결재시간_평균": 0.25158406991756876, "문서공개율_평균": 0.09981130201608898, "표본수": 50345}, {"국": "안전건설국", "생산문서수_평균": 58543.0, "결재시간_평균": 0.30871325350596995, "문서공개율_평균": 0.0991066395640811, "표본수": 58543}, {"국": "기획재정국", "생산문서수_평균": 38634.0, "결재시간_평균": 0.22855515866853032, "문서공개율_평균": 0.09121499197597971, "표본수": 38634}, {"국": "도시관리국", "생산문서수_평균": 52761.0, "결재시간_평균": 0.17421959401830897, "문서공개율_평균": 0.05138265006349387, "표본수": 52761}]}};
const AVG_COLOR = "red";

function drawBar(divId, DATA, yKey, yTitle, barColor) {
  const x = (DATA || []).map(d => d["국"]);
  const y = (DATA || []).map(d => d[yKey]);

  function formatValue(key, value) {
    if (value === null || value === undefined || !Number.isFinite(value)) return "N/A";
    if (key === "생산문서수_평균") return Math.round(value).toLocaleString() + "건";
    if (key === "결재시간_평균") return value.toFixed(2) + "일";
    if (key === "문서공개율_평균") return (value * 100).toFixed(1) + "%";
    return value.toFixed(2);
  }

  const validY = y.filter(v => v !== null && Number.isFinite(v));
  const meanY = validY.length ? validY.reduce((a,b)=>a+b,0)/validY.length : null;

  const trace = {
    type: "bar",
    x: x,
    y: y,
    marker: { color: barColor },
    hovertext: x.map((k,i)=> `${k}<br>${yTitle} ${formatValue(yKey, y[i])}`),
    hoverinfo: "text"
  };

  const shapes = (meanY !== null) ? [{
    type: "line",
    xref: "paper",
    x0: 0,
    x1: 1,
    y0: meanY,
    y1: meanY,
    line: { color: AVG_COLOR, width: 2, dash: "dash" }
  }] : [];

  const annotations = (meanY !== null) ? [{
    xref: "paper",
    yref: "y",
    x: 1.005,
    y: meanY,
    text: `평균: ${formatValue(yKey, meanY)}`,
    showarrow: false,
    font: { color: AVG_COLOR, size: 12 },
    xanchor: "left"
  }] : [];

  const yaxisConfig = (yKey === "문서공개율_평균")
    ? { title: yTitle, rangemode: "tozero", tickformat: ".0%" }
    : { title: yTitle, rangemode: "tozero" };

  const layout = {
    margin: {l:60, r:110, t:80, b:140},
    xaxis: { title: "", tickangle: -45 },
    yaxis: yaxisConfig,
    shapes: shapes,
    annotations: annotations
  };

  Plotly.react(divId, [trace], layout, {responsive:true});
}

const COLORS = { PROD:"#A7C7E7", TIME:"#B8E0C8", OPEN:"#FFD6A5" };

function setActive(rangeKey){
  document.querySelectorAll(".btn").forEach(b=>{
    b.classList.toggle("active", b.dataset.range === rangeKey);
  });
}

function render(rangeKey){
  const ds = DATASETS[rangeKey] || {PROD:[], TIME:[], OPEN:[]};
  const note = document.getElementById("rangeNote");

  const hasAny = (ds.PROD && ds.PROD.length) || (ds.TIME && ds.TIME.length) || (ds.OPEN && ds.OPEN.length);

  drawBar("c1", ds.PROD || [], "생산문서수_평균", "", COLORS.PROD);
  drawBar("c2", ds.TIME || [], "결재시간_평균",   "", COLORS.TIME);
  drawBar("c3", ds.OPEN || [], "문서공개율_평균", "", COLORS.OPEN);
}

// 초기 렌더: 전체
setActive("ALL");
render("ALL");

// 버튼 이벤트
document.querySelectorAll(".btn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const rangeKey = btn.dataset.range;
    setActive(rangeKey);
    render(rangeKey);
  });
});
</script>

<link rel="stylesheet" href="./common.css" />
<script src="./nav.js"></script>
</body>
</html>
