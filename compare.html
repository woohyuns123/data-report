
<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>국별 비교분석</title>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#fff; }
  .wrap { max-width:1200px; margin:40px auto; padding:0 16px; }
  h2 { margin:0 0 12px; }
  .block { border:1px solid #eee; border-radius:12px; padding:12px; margin-bottom:16px; }
  .title { font-size:14px; margin:4px 6px 8px; }
  .chart { height:420px; }
</style>
</head>
<body data-page="compare">
<div class="wrap">
  <h2>국별 비교분석</h2>

  <div class="block">
    <div class="title">생산문서수 평균</div>
    <div id="c1" class="chart"></div>
  </div>

  <div class="block">
    <div class="title">결재시간 평균</div>
    <div id="c2" class="chart"></div>
  </div>

  <div class="block">
    <div class="title">문서공개율 평균</div>
    <div id="c3" class="chart"></div>
  </div>
</div>

<script>
const DATA_PROD = [{"국": "동주민센터", "생산문서수_평균": 270254.0, "결재시간_평균": 0.2472673854966069, "문서공개율_평균": 0.39384800965018096, "표본수": 270254}, {"국": "주민생활국", "생산문서수_평균": 173912.0, "결재시간_평균": 0.3942051152306914, "문서공개율_평균": 0.13438405630433783, "표본수": 173912}, {"국": "안전건설국", "생산문서수_평균": 165225.0, "결재시간_평균": 0.3279648963534574, "문서공개율_평균": 0.13727341504009682, "표본수": 165225}, {"국": "공간혁신국", "생산문서수_평균": 157023.0, "결재시간_평균": 0.3122790928717449, "문서공개율_평균": 0.2138094419288894, "표본수": 157023}, {"국": "보건소", "생산문서수_평균": 142245.0, "결재시간_평균": 0.277591479489613, "문서공개율_평균": 0.14567120109669934, "표본수": 142245}, {"국": "도시관리국", "생산문서수_평균": 138845.0, "결재시간_평균": 0.17497929345673233, "문서공개율_평균": 0.07042385393784435, "표본수": 138845}, {"국": "문화행정국", "생산문서수_평균": 134805.0, "결재시간_평균": 0.35821371610845293, "문서공개율_평균": 0.2779273765809874, "표본수": 134805}, {"국": "기획재정국", "생산문서수_평균": 110913.0, "결재시간_평균": 0.24954694219793894, "문서공개율_평균": 0.11062724838386843, "표본수": 110913}, {"국": "밝은미래국", "생산문서수_평균": 102708.0, "결재시간_평균": 0.3184367332632317, "문서공개율_평균": 0.19331502901429296, "표본수": 102708}, {"국": "직속기관", "생산문서수_평균": 22961.0, "결재시간_평균": 0.24881320499978224, "문서공개율_평균": 0.28587605069465616, "표본수": 22961}];
const DATA_TIME = [{"국": "주민생활국", "생산문서수_평균": 173912.0, "결재시간_평균": 0.3942051152306914, "문서공개율_평균": 0.13438405630433783, "표본수": 173912}, {"국": "문화행정국", "생산문서수_평균": 134805.0, "결재시간_평균": 0.35821371610845293, "문서공개율_평균": 0.2779273765809874, "표본수": 134805}, {"국": "안전건설국", "생산문서수_평균": 165225.0, "결재시간_평균": 0.3279648963534574, "문서공개율_평균": 0.13727341504009682, "표본수": 165225}, {"국": "밝은미래국", "생산문서수_평균": 102708.0, "결재시간_평균": 0.3184367332632317, "문서공개율_평균": 0.19331502901429296, "표본수": 102708}, {"국": "공간혁신국", "생산문서수_평균": 157023.0, "결재시간_평균": 0.3122790928717449, "문서공개율_평균": 0.2138094419288894, "표본수": 157023}, {"국": "보건소", "생산문서수_평균": 142245.0, "결재시간_평균": 0.277591479489613, "문서공개율_평균": 0.14567120109669934, "표본수": 142245}, {"국": "기획재정국", "생산문서수_평균": 110913.0, "결재시간_평균": 0.24954694219793894, "문서공개율_평균": 0.11062724838386843, "표본수": 110913}, {"국": "직속기관", "생산문서수_평균": 22961.0, "결재시간_평균": 0.24881320499978224, "문서공개율_평균": 0.28587605069465616, "표본수": 22961}, {"국": "동주민센터", "생산문서수_평균": 270254.0, "결재시간_평균": 0.2472673854966069, "문서공개율_평균": 0.39384800965018096, "표본수": 270254}, {"국": "도시관리국", "생산문서수_평균": 138845.0, "결재시간_평균": 0.17497929345673233, "문서공개율_평균": 0.07042385393784435, "표본수": 138845}];
const DATA_OPEN = [{"국": "동주민센터", "생산문서수_평균": 270254.0, "결재시간_평균": 0.2472673854966069, "문서공개율_평균": 0.39384800965018096, "표본수": 270254}, {"국": "직속기관", "생산문서수_평균": 22961.0, "결재시간_평균": 0.24881320499978224, "문서공개율_평균": 0.28587605069465616, "표본수": 22961}, {"국": "문화행정국", "생산문서수_평균": 134805.0, "결재시간_평균": 0.35821371610845293, "문서공개율_평균": 0.2779273765809874, "표본수": 134805}, {"국": "공간혁신국", "생산문서수_평균": 157023.0, "결재시간_평균": 0.3122790928717449, "문서공개율_평균": 0.2138094419288894, "표본수": 157023}, {"국": "밝은미래국", "생산문서수_평균": 102708.0, "결재시간_평균": 0.3184367332632317, "문서공개율_평균": 0.19331502901429296, "표본수": 102708}, {"국": "보건소", "생산문서수_평균": 142245.0, "결재시간_평균": 0.277591479489613, "문서공개율_평균": 0.14567120109669934, "표본수": 142245}, {"국": "안전건설국", "생산문서수_평균": 165225.0, "결재시간_평균": 0.3279648963534574, "문서공개율_평균": 0.13727341504009682, "표본수": 165225}, {"국": "주민생활국", "생산문서수_평균": 173912.0, "결재시간_평균": 0.3942051152306914, "문서공개율_평균": 0.13438405630433783, "표본수": 173912}, {"국": "기획재정국", "생산문서수_평균": 110913.0, "결재시간_평균": 0.24954694219793894, "문서공개율_평균": 0.11062724838386843, "표본수": 110913}, {"국": "도시관리국", "생산문서수_평균": 138845.0, "결재시간_평균": 0.17497929345673233, "문서공개율_평균": 0.07042385393784435, "표본수": 138845}];

const AVG_COLOR = "red";

function drawBar(divId, DATA, yKey, yTitle) {
  const x = DATA.map(d => d["국"]);
  const y = DATA.map(d => d[yKey]);
  const n = DATA.map(d => d["표본수"]);

  // null/undefined/NaN 제거
  const validY = y.filter(v => v !== null && v !== undefined && Number.isFinite(v));
  const meanY = validY.length ? validY.reduce((a,b)=>a+b,0) / validY.length : null;

  const trace = {
    type: "bar",
    x: x,
    y: y,
    hovertext: x.map((k,i)=>
      `국: ${k}<br>${yTitle}: ${Number.isFinite(y[i]) ? y[i].toFixed(2) : "N/A"}<br>표본수: ${n[i]}`
    ),
    hoverinfo: "text"
  };

  const shapes = (meanY !== null) ? [{
    type: "line",
    xref: "paper",
    x0: 0,
    x1: 1,
    y0: meanY,
    y1: meanY,
    line: {
      color: AVG_COLOR,
      width: 2,
      dash: "dash"
    }
  }] : [];

  const annotations = (meanY !== null) ? [{
    xref: "paper",
    yref: "y",
    x: 1.02,
    y: meanY,
    text: `평균: ${meanY.toFixed(2)}`,
    showarrow: false,
    font: { color: AVG_COLOR, size: 12 },
    xanchor: "left"
  }] : [];

  const layout = {
    margin: {l:60, r:110, t:20, b:140},
    xaxis: { title: "국", tickangle: -45 },
    yaxis: { title: yTitle, rangemode: "tozero" },
    shapes: shapes,
    annotations: annotations
  };

  Plotly.react(divId, [trace], layout, {responsive:true});
}

drawBar("c1", DATA_PROD, "생산문서수_평균", "생산문서수(평균)");
drawBar("c2", DATA_TIME, "결재시간_평균", "결재시간(평균)");
drawBar("c3", DATA_OPEN, "문서공개율_평균", "문서공개율(평균)");
</script>
<link rel="stylesheet" href="./common.css" />
<script src="./nav.js"></script>

</body>
</html>
